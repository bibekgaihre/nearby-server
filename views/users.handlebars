{{> navbar}}
<div class="container-fluid">
  <div class="row">{{> sidebar}}</div>
  <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
    <div
      class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
    >
      <h2 class="h3 heading"><strong>Nearby Chat</strong></h2>
    </div>
    <div class="row">
      <div class="col-md-3 mb-3">
        <h3 class="heading">Users</h3>
      </div>
      <div class="col-md-3 mb-3"></div>
      <div class="col-md-3 mb-3"></div>

      <div class="col-md-3 mb-3">
       
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-sm" id="users_datatable">
        <thead>
          <tr>
            <th>Username</th>
            <th>Image</th>
            <th>Registered on</th>
            <th>Verified</th>
            <th>Options</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>
</div>
{{> foot}}
<!-- <script src="https://code.jquery.com/jquery-3.5.1.js"></script> -->
<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", (event) => {

    $("#users_datatable").DataTable({
      searching: false,
      pageLength: 10,
      processing: true,
      stateSave: true,
      pagination: true,
      bPagination: true,
      pagingType: "full_numbers",
      responsive: true,
      filter: true,
      sort: false,
      serverSide: true,
      dom:
        "<'row'<'col-sm-12'tr>>" +
        "<'row'<'col-sm-5'i><'col-sm-7'<'float-right p-2'p>>>",
      ajax: {
        url: "/api/admin/get-users",
        headers: { Authorization: "Bearer " + Cookies.get("token") },
        method: "GET",
        dataFilter: (data) => {

          let json = JSON.parse(data);
          json.recordsTotal = json.total;
          json.recordsFiltered = json.total;
          return JSON.stringify(json);
        },
        data: function (d) {
          return $.extend(
            {},
            {
              start: d.start,
              limit: d.length,
              search: d.search,
            }
          );
        },
      },
      columns: [
        {
          data: "username",
          class: "text-center",
        },
        {
          data: "tag",
          class: "text-center",
        },
        {
          data: null,
          class: "text-center",
          render: (d, type, row, meta) => {
            return `${new Date(d.created_at)}`;
          },
        },
      
        {
          data: null,
          class: "text-center",
          render: (d, type, row, meta) => {
            if (d.isActive === true) {
              return `<svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-check2" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
      </svg>`;
            } else {
              return `<svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-x" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
</svg>`;
            }
          },
        },
        {
          data: null,
          class: "text-center",
          render: (d, type, row, meta) => {
            return `<button type="button" class="btn btn-sm btn-outline-primary" onclick="window.location.replace('/blogs/${d._id}')"
    title="View">
    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-binoculars-fill" fill="currentColor"
        xmlns="http://www.w3.org/2000/svg">
        <path
            d="M4.5 1A1.5 1.5 0 0 0 3 2.5V3h4v-.5A1.5 1.5 0 0 0 5.5 1h-1zM7 4v1h2V4h4v.882a.5.5 0 0 0 .276.447l.895.447A1.5 1.5 0 0 1 15 7.118V13H9v-1.5a.5.5 0 0 1 .146-.354l.854-.853V9.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v.793l.854.853A.5.5 0 0 1 7 11.5V13H1V7.118a1.5 1.5 0 0 1 .83-1.342l.894-.447A.5.5 0 0 0 3 4.882V4h4zM1 14v.5A1.5 1.5 0 0 0 2.5 16h3A1.5 1.5 0 0 0 7 14.5V14H1zm8 0v.5a1.5 1.5 0 0 0 1.5 1.5h3a1.5 1.5 0 0 0 1.5-1.5V14H9zm4-11H9v-.5A1.5 1.5 0 0 1 10.5 1h1A1.5 1.5 0 0 1 13 2.5V3z" />
    </svg>
</button>
<button type="button" id="deletebtn" data-id="${d._id}" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteModal" class="btn btn-sm btn-outline-danger" 
    title="Delete">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
  <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
</svg>
</button>
`;
          },
        },
      ],
    });
  });
</script>

<div
  class="modal fade"
  id="deleteModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Delete Article</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to Remove this Article ?
        <span id="delete-modal-id" hidden></span>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-dismiss="modal"
        >
          No
        </button>
        <button type="button" class="btn btn-outline-danger" id="btnDelete">
          <svg
            width="1em"
            height="1em"
            viewBox="0 0 16 16"
            class="bi bi-trash-fill"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z"
            /></svg
          >Remove
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="success-remove-modal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLongTitle"
  aria-hidden="true"
>
  <div
    class="modal-dialog modal-dialog-centered"
    role="docexampleModalLongument"
  >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">
          Successfully Removed
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">The Article has been removed Successfully.</div>
    </div>
  </div>
</div>

<script>
  $(document).on("click", "#deletebtn", function () {
    let id = $(this).data("id");
    document.getElementById("delete-modal-id").innerHTML = id;
  });
  document.getElementById("btnDelete").addEventListener("click", () => {
    let id = document.getElementById("delete-modal-id").innerText;
    fetch(`/api/v1/blogs/${id}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer " + Cookies.get("token"),
      },
    }).then((response) => {
      if (response.ok) {
        $("#deleteModal").modal("hide");
        setTimeout(function () {
          $("#success-remove-modal").modal("show");
        }, 300);
        $("#articles_datatable").DataTable().ajax.reload(null, false);
        setTimeout(function () {
          $("#success-remove-modal").modal("hide");
        }, 2000);
      }
    });
  });
</script>